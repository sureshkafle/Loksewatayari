@page 
@model LokFrontend.Pages.QuizPage.PracticepageModel
@{
}

@* <h2 class="text-center mt-3">Online Quiz</h2>

<div class="quiz-container">

    <!-- QUIZ SECTION -->
    <section id="quiz"></section>

    <!-- ASIDE -->
    <aside>
        <h4>Time Left</h4>
        <div class="timer" id="timer">05:00</div>

        <h4 class="mt-3">
            Score: <span id="score">0</span>/10
        </h4>
    </aside>

</div> *@

<section class="notice-section">
<h2>Online Quiz</h2>

<div class="quiz-header">
    ⏱ Time: <span id="timer">60</span> sec |
    📊 Total Questions: @Model.Questions.Count |
    ✅ Correct Answers: @Model.Score
</div>

<form class="notice-card" method="post" id="quizForm">

@for (int i = 0; i < Model.Questions.Count; i++)
{
    <div class="question-box">
        <p class="question-text">
            @(i + 1). @Model.Questions[i].Text
        </p>

        @for (int j = 0; j < Model.Questions[i].Options.Count; j++)
        {
            string cssClass = "";
            bool isChecked = Model.UserAnswers != null &&
                             Model.UserAnswers.Count > i &&
                             Model.UserAnswers[i] == j;

            if (Model.IsSubmitted)
            {
                if (j == Model.Questions[i].CorrectAnswer)
                    cssClass = "correct";
                else if (isChecked)
                    cssClass = "wrong";
            }

            <label class="option-label @cssClass">
                <input type="radio"
                       name="UserAnswers[@i]"
                       value="@j"
                       @(isChecked ? "checked" : "")
                       @(Model.IsSubmitted ? "disabled" : "")
                       required />
                @Model.Questions[i].Options[j]
            </label>
        }
    </div>
}

<button type="submit" id="submitBtn" @(Model.IsSubmitted ? "disabled" : "")>
    Submit Quiz
</button>

</form>
</section>

<script>
    let timeLeft = 60;
    let timer = document.getElementById("timer");
    let form = document.getElementById("quizForm");
    let submitted = false;

    function submitQuiz() {
        if (!submitted) {
            submitted = true;
            form.submit();
        }
    }

    let countdown = setInterval(function () {
        timeLeft--;
        timer.innerText = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(countdown);
            alert("Time is up! Submitting quiz...");
            submitQuiz();
        }
    }, 1000);

    document.getElementById("submitBtn").addEventListener("click", function () {
        submitted = true;
    });
</script>
